<?xml version="1.0" encoding="UTF-8"?>
<ViewConfig>
  <Arguments/>
  <Context>
    <Attribute name="month"/>
    <Attribute name="year"/>
  </Context>
  <Model/>
  <View>
    <Property name="visible">true</Property>
    <Property name="styleSheetFile">/optv/optvstyle1.css</Property>
    <YearDropDown id="yddYear"/>
    <ListDropDown id="lddMonth">
      <Property name="items">
        <Collection>
          <Entity>
            <Property name="label">一月</Property>
            <Property name="key">1</Property>
          </Entity>
          <Entity>
            <Property name="label">二月</Property>
            <Property name="key">2</Property>
          </Entity>
          <Entity>
            <Property name="label">三月</Property>
            <Property name="key">3</Property>
          </Entity>
          <Entity>
            <Property name="label">四月</Property>
            <Property name="key">4</Property>
          </Entity>
          <Entity>
            <Property name="label">五月</Property>
            <Property name="key">5</Property>
          </Entity>
          <Entity>
            <Property name="label">六月</Property>
            <Property name="key">6</Property>
          </Entity>
          <Entity>
            <Property name="label">七月</Property>
            <Property name="key">7</Property>
          </Entity>
          <Entity>
            <Property name="label">八月</Property>
            <Property name="key">8</Property>
          </Entity>
          <Entity>
            <Property name="label">九月</Property>
            <Property name="key">9</Property>
          </Entity>
          <Entity>
            <Property name="label">十月</Property>
            <Property name="key">10</Property>
          </Entity>
          <Entity>
            <Property name="label">十一月</Property>
            <Property name="key">11</Property>
          </Entity>
          <Entity>
            <Property name="label">十二月</Property>
            <Property name="key">12</Property>
          </Entity>
        </Collection>
      </Property>
      <Property name="property">key</Property>
      <Property name="displayProperty">label</Property>
    </ListDropDown>
    <AjaxAction id="aaWriteExcel">
      <Property name="service">writeExcel#writeExcel</Property>
    </AjaxAction>
    <DownloadAction id="aaDownLoadFile">
      <Property name="fileProvider">downLoadFile#download</Property>
      <Property name="parameter"></Property>
    </DownloadAction>
    <DataSet id="dsPointQuotaViewHtml">
      <Property name="dataType">String</Property>
      <Property name="dataProvider">poiReadExcel#getHtml</Property>
    </DataSet>
    <ToolBar>
      <Property name="fixRight">true</Property>
      <Property name="draggable">true</Property>
      <Property name="hideMode">visibility</Property>
      <Separator/>
      <ToolBarLabel>
        <Property name="text">年度</Property>
      </ToolBarLabel>
      <TextEditor id="teYear">
        <ClientEvent name="onReady">var date=new Date();&#xD;
var year;&#xD;
var month=date.getMonth();&#xD;
&#xD;
function isIe(){&#xD;
   return (&quot;ActiveXObject&quot; in window);&#xD;
}&#xD;
&#xD;
if(isIe()){&#xD;
	if(!-[1,]&amp;&amp;document.documentMode){&#xD;
		//alert(&quot;ie8&quot;);&#xD;
		year=(date.getYear());&#xD;
	}else{&#xD;
		//alert(&quot;ie9&quot;);&#xD;
		year=(date.getYear())+1900;&#xD;
	}&#xD;
	&#xD;
}else{&#xD;
	//alert(&quot;chrome&quot;);&#xD;
	year=(date.getYear())+1900;&#xD;
}&#xD;
&#xD;
if(month==0){&#xD;
	year=year-1;&#xD;
}&#xD;
&#xD;
year=parseInt(year);&#xD;
self.set(&quot;text&quot;,year);&#xD;
view.set(&quot;context.year&quot;,year);</ClientEvent>
        <ClientEvent name="onPost">teYear=view.get(&quot;#teYear&quot;);&#xD;
year=parseInt(teYear.get(&quot;text&quot;));&#xD;
teMonth=view.get(&quot;#teMonth&quot;);&#xD;
month=teMonth.get(&quot;text&quot;);&#xD;
dsPointQuotaViewHtml=view.get(&quot;#dsPointQuotaViewHtml&quot;);&#xD;
hc1=view.get(&quot;#hc1&quot;);&#xD;
aaWriteExcel=view.get(&quot;#aaWriteExcel&quot;);&#xD;
dlgView=view.get(&quot;#dlgView&quot;);&#xD;
&#xD;
view.set(&quot;context.year&quot;,year);&#xD;
aaWriteExcel.set(&quot;parameter&quot;,{year:year,month:month});&#xD;
aaWriteExcel.execute({&#xD;
	callback : function(success, obj){&#xD;
		if (success) {&#xD;
			dsPointQuotaViewHtml.flush();&#xD;
			var html=dsPointQuotaViewHtml.getData();&#xD;
			hc1.refresh(true);&#xD;
			hc1.set(&quot;content&quot;,html);&#xD;
			hc1.refresh(true);&#xD;
        }&#xD;
	}&#xD;
});</ClientEvent>
        <Property name="trigger">yddYear</Property>
        <Property name="width">70</Property>
      </TextEditor>
      <ToolBarLabel>
        <Property name="text">月度</Property>
      </ToolBarLabel>
      <TextEditor id="teMonth">
        <ClientEvent name="onReady">var date=new Date();&#xD;
var year;&#xD;
var month=date.getMonth();&#xD;
&#xD;
if(month==0){&#xD;
	month=12;&#xD;
}&#xD;
&#xD;
month=parseInt(month);&#xD;
self.set(&quot;text&quot;,month);&#xD;
view.set(&quot;context.month&quot;,month);</ClientEvent>
        <ClientEvent name="onPost">teYear=view.get(&quot;#teYear&quot;);&#xD;
year=parseInt(teYear.get(&quot;text&quot;));&#xD;
teMonth=view.get(&quot;#teMonth&quot;);&#xD;
month=parseInt(teMonth.get(&quot;text&quot;));&#xD;
dsPointQuotaViewHtml=view.get(&quot;#dsPointQuotaViewHtml&quot;);&#xD;
hc1=view.get(&quot;#hc1&quot;);&#xD;
aaWriteExcel=view.get(&quot;#aaWriteExcel&quot;);&#xD;
dlgView=view.get(&quot;#dlgView&quot;);&#xD;
&#xD;
view.set(&quot;context.month&quot;,month);&#xD;
aaWriteExcel.set(&quot;parameter&quot;,{year:year,month:month});&#xD;
aaWriteExcel.execute({&#xD;
	callback : function(success, obj){&#xD;
		if (success) {&#xD;
			dsPointQuotaViewHtml.flush();&#xD;
			var html=dsPointQuotaViewHtml.getData();&#xD;
			hc1.refresh(true);&#xD;
			hc1.set(&quot;content&quot;,html);&#xD;
			hc1.refresh(true);&#xD;
        }&#xD;
	}&#xD;
});</ClientEvent>
        <Property name="trigger">lddMonth</Property>
        <Property name="width">70</Property>
      </TextEditor>
      <Separator/>
      <ToolBarButton>
        <ClientEvent name="onClick">var teYear=view.get(&quot;#teYear&quot;);&#xD;
var year=parseInt(teYear.get(&quot;text&quot;));&#xD;
var teMonth=view.get(&quot;#teMonth&quot;);&#xD;
var month=parseInt(teMonth.get(&quot;text&quot;));&#xD;
&#xD;
var aaDownLoadFile=view.get(&quot;#aaDownLoadFile&quot;);&#xD;
aaDownLoadFile.set(&quot;parameter&quot;,{year:year,month:month});&#xD;
aaDownLoadFile.execute();</ClientEvent>
        <Property name="caption">导出</Property>
        <Property name="visible">true</Property>
        <Property name="icon">url(>skin>common/icons.gif) -140px -240px</Property>
      </ToolBarButton>
      <ToolBarButton>
        <ClientEvent name="onClick">function xlPrint(){  &#xD;
  var xlApp;&#xD;
  var xlBook;&#xD;
  var xlSheet;&#xD;
  try{   &#xD;
    xlApp = new ActiveXObject(&quot;Excel.Application&quot;);   &#xD;
  }catch(e){   &#xD;
    alert(&quot;ActiveX&quot;);   &#xD;
    return;   &#xD;
  }   &#xD;
  &#xD;
  var xlBook = xlApp.Workbooks.open(&quot;http://10.195.49.168:8080/t1/FileDownload2&quot;);   &#xD;
  //var xlBook = xlApp.Workbooks.open(&quot;http://localhost:8080/t1/FileDownload2&quot;);&#xD;
  var xlSheet = xlBook.Worksheets(1);       &#xD;
    &#xD;
  xlBook.Worksheets(1).Activate;   &#xD;
  xlApp.visible = true;&#xD;
  xlSheet.PrintPreview;&#xD;
  xlSheet.PageSetup.Orientation=2;&#xD;
  xlBook.Close(false);&#xD;
  xlApp.Quit();   &#xD;
  xlApp = null;   &#xD;
}&#xD;
&#xD;
xlPrint();</ClientEvent>
        <Property name="caption">打印</Property>
        <Property name="visible">true</Property>
        <Property name="icon">url(>skin>common/icons.gif) -120px -20px</Property>
      </ToolBarButton>
    </ToolBar>
    <HtmlContainer id="hc1" listener="spring:keyPointQuotaItemViewInit#Hc1Init">
      <Property name="visible">true</Property>
      <Property name="hideMode">visibility</Property>
      <Property name="containerUi">default</Property>
      <Property name="draggable">false</Property>
      <Property name="droppable">false</Property>
    </HtmlContainer>
  </View>
</ViewConfig>
