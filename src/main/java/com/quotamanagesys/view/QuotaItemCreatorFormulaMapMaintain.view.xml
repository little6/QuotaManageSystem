<?xml version="1.0" encoding="UTF-8"?>
<ViewConfig>
  <Arguments/>
  <Context/>
  <Model>
    <DataType name="QuotaFormula">
      <Property name="creationType">com.quotamanagesys.model.QuotaFormula</Property>
      <PropertyDef name="id">
        <Property name="dataType">String</Property>
      </PropertyDef>
      <PropertyDef name="name">
        <Property name="dataType">String</Property>
      </PropertyDef>
      <PropertyDef name="formula">
        <Property name="dataType">String</Property>
      </PropertyDef>
      <PropertyDef name="quotaFormulaResult">
        <Property name="dataType">QuotaFormulaResult</Property>
      </PropertyDef>
      <PropertyDef name="remark">
        <Property name="dataType">String</Property>
      </PropertyDef>
    </DataType>
    <DataType name="QuotaFormulaResult">
      <Property name="creationType">com.quotamanagesys.model.QuotaFormulaResult</Property>
      <Property name="defaultDisplayProperty">resultName</Property>
      <PropertyDef name="id">
        <Property name="dataType">String</Property>
      </PropertyDef>
      <PropertyDef name="name">
        <Property name="dataType">String</Property>
      </PropertyDef>
    </DataType>
    <DataType name="QuotaItemCreator" parent="global:QuotaItemCreator">
      <PropertyDef name="quotaPropertiesNames">
        <Property name="dataType">String</Property>
      </PropertyDef>
    </DataType>
    <DataType name="Department">
      <Property name="creationType">com.bstek.bdf2.core.model.DefaultDept</Property>
      <Property name="defaultDisplayProperty">name</Property>
      <PropertyDef name="id">
        <Property name="dataType">String</Property>
      </PropertyDef>
      <PropertyDef name="name">
        <Property name="dataType">String</Property>
      </PropertyDef>
      <PropertyDef name="desc">
        <Property name="dataType">String</Property>
      </PropertyDef>
      <PropertyDef name="companyId">
        <Property name="dataType">String</Property>
      </PropertyDef>
      <PropertyDef name="createDate">
        <Property name="dataType">Date</Property>
      </PropertyDef>
      <PropertyDef name="parentId">
        <Property name="dataType">String</Property>
      </PropertyDef>
    </DataType>
  </Model>
  <View>
    <DataSet id="dsQuotaFormula">
      <Property name="dataType">[QuotaFormula]</Property>
      <Property name="dataProvider">quotaFormulaDao#getQuotaFormulasByResult</Property>
    </DataSet>
    <DataSet id="dsQuotaFormulaResult">
      <Property name="dataType">[QuotaFormulaResult]</Property>
      <Property name="dataProvider">quotaFormulaResultDao#getAll</Property>
    </DataSet>
    <DataSet id="dsQuotaItemCreator">
      <Property name="dataProvider">quotaItemCreatorDao#getQuotaItemCreatorsByManageDept2</Property>
      <Property name="dataType">[QuotaItemCreator]</Property>
    </DataSet>
    <DataSet id="dsQuotaItemCreator2">
      <Property name="dataProvider">quotaItemCreatorDao#getQuotaItemCreatorsByFormula</Property>
      <Property name="dataType">[QuotaItemCreator]</Property>
    </DataSet>
    <DataSet id="dsDepartment">
      <Property name="dataType">[Department]</Property>
      <Property name="dataProvider">departmentDao#getAll</Property>
    </DataSet>
    <SplitPanel>
      <Property name="position">200</Property>
      <MainControl>
        <Container>
          <SplitPanel>
            <Property name="position">35%</Property>
            <Property name="direction">left</Property>
            <MainControl>
              <Container>
                <ToolBar>
                  <DataPilot>
                    <ClientEvent name="onSubControlAction">var datas = view.get(&quot;#dsQuotaItemCreator2&quot;).get(&quot;data&quot;);&#xD;
var dgQuotaItemCreatorSelected=view.get(&quot;#dgQuotaItemCreatorSelected&quot;);&#xD;
var selection=dgQuotaItemCreatorSelected.get(&quot;selection&quot;);&#xD;
var messge;&#xD;
&#xD;
switch(arg.code){&#xD;
	case &quot;+&quot;:{&#xD;
		view.get(&quot;#dlgQuotaItemCreator&quot;).show();&#xD;
		arg.processDefault=false;&#xD;
		break;&#xD;
	}&#xD;
	case &quot;-&quot;:{&#xD;
		dgQuotaItemCreatorSelected.refresh();&#xD;
		dorado.MessageBox.confirm(&quot;您真的想删除当前数据吗?&quot;,function(){	&#xD;
			if (selection &amp;&amp; selection.length) {&#xD;
				selection.each(function(data){&#xD;
					datas.remove(data);&#xD;
				});&#xD;
			}else {message = &quot;未选中任何证书类型！&quot;;}&#xD;
		});&#xD;
		arg.processDefault=false;&#xD;
		break;&#xD;
	}&#xD;
}&#xD;
</ClientEvent>
                    <Property name="itemCodes">pages,+,-,x</Property>
                    <Property name="dataSet">dsQuotaItemCreator2</Property>
                  </DataPilot>
                  <ToolBarButton>
                    <ClientEvent name="onClick">var dgQuotaFormula=view.get(&quot;#dgQuotaFormula&quot;);&#xD;
var dgQuotaItemCreatorSelected=view.get(&quot;#dgQuotaItemCreatorSelected&quot;);&#xD;
var currentQuotaFormula=dgQuotaFormula.get(&quot;currentEntity&quot;);&#xD;
var quotaFormulaId=currentQuotaFormula.get(&quot;id&quot;);&#xD;
var uaQuotaItemCreator=view.get(&quot;#uaQuotaItemCreator&quot;);&#xD;
var dsQuotaItemCreator2=view.get(&quot;#dsQuotaItemCreator2&quot;);&#xD;
&#xD;
uaQuotaItemCreator.set(&quot;parameter&quot;,{quotaFormulaId:quotaFormulaId});&#xD;
uaQuotaItemCreator.execute({&#xD;
	callback:function(success,obj){&#xD;
		if (success) {&#xD;
			dsQuotaItemCreator2.set(&quot;parameter&quot;,{quotaFormulaId:quotaFormulaId}).flushAsync();&#xD;
			dgQuotaItemCreatorSelected.refresh();&#xD;
		}else{&#xD;
			alert(&quot;执行失败！发生异常：&quot; + obj)&#xD;
		}&#xD;
	}&#xD;
})&#xD;
</ClientEvent>
                    <Property name="icon">url(>skin>common/icons.gif) -140px -20px</Property>
                    <Property name="caption">保存</Property>
                  </ToolBarButton>
                </ToolBar>
                <DataGrid id="dgQuotaItemCreatorSelected">
                  <Property name="dataSet">dsQuotaItemCreator2</Property>
                  <Property name="dataType">QuotaItemCreator</Property>
                  <Property name="readOnly">true</Property>
                  <Property name="selectionMode">multiRows</Property>
                  <Property name="stretchColumnsMode">allColumns</Property>
                  <Property name="dynaRowHeight">true</Property>
                  <IndicatorColumn/>
                  <RowSelectorColumn/>
                  <DataColumn name="id">
                    <Property name="property">id</Property>
                    <Property name="visible">false</Property>
                  </DataColumn>
                  <DataColumn name="name">
                    <Property name="visible">false</Property>
                  </DataColumn>
                  <DataColumn>
                    <Property name="property">quotaType.name</Property>
                    <Property name="name">showName</Property>
                    <Property name="caption">指标名称</Property>
                    <Property name="width">160</Property>
                    <Property name="wrappable">true</Property>
                    <Editor>
                      <TextArea/>
                    </Editor>
                  </DataColumn>
                  <DataColumn name="quotaDutyDept">
                    <Property name="property">quotaDutyDept.name</Property>
                    <Property name="visible">true</Property>
                    <Property name="caption">责任部门</Property>
                    <Property name="width">80</Property>
                    <Property name="align">center</Property>
                  </DataColumn>
                  <DataColumn name="year">
                    <Property name="property">year</Property>
                    <Property name="caption">年度</Property>
                    <Property name="width">60</Property>
                    <Property name="align">center</Property>
                  </DataColumn>
                  <ColumnGroup>
                    <Property name="caption">指标种类信息</Property>
                    <DataColumn name="quotaType">
                      <Property name="property">quotaType</Property>
                      <Property name="visible">false</Property>
                    </DataColumn>
                    <DataColumn>
                      <Property name="property">quotaType.name</Property>
                      <Property name="name">quotaTypeName</Property>
                      <Property name="caption">指标种类名称</Property>
                      <Property name="width">160</Property>
                      <Property name="visible">false</Property>
                      <Editor/>
                    </DataColumn>
                    <DataColumn>
                      <Property name="property">quotaType.rate</Property>
                      <Property name="name">quotaTypeRate</Property>
                      <Property name="caption">考核频率</Property>
                      <Property name="width">60</Property>
                      <Property name="align">center</Property>
                      <Editor/>
                    </DataColumn>
                    <DataColumn>
                      <Property name="property">quotaType.quotaLevel.name</Property>
                      <Property name="name">quotaLevel</Property>
                      <Property name="caption">指标级别</Property>
                      <Property name="width">80</Property>
                      <Property name="align">center</Property>
                      <Editor/>
                    </DataColumn>
                    <DataColumn>
                      <Property name="property">quotaType.quotaUnit.name</Property>
                      <Property name="name">quotaUnit</Property>
                      <Property name="caption">计量单位</Property>
                      <Property name="width">60</Property>
                      <Property name="align">center</Property>
                      <Editor/>
                    </DataColumn>
                    <DataColumn>
                      <Property name="property">quotaType.manageDept.name</Property>
                      <Property name="name">manageDept</Property>
                      <Property name="caption">管理部门</Property>
                      <Property name="width">80</Property>
                      <Editor/>
                    </DataColumn>
                    <DataColumn>
                      <Property name="property">quotaType.quotaDimension.name</Property>
                      <Property name="caption">维度</Property>
                      <Property name="width">80</Property>
                      <Property name="align">center</Property>
                      <Property name="name">quotaDimension</Property>
                    </DataColumn>
                  </ColumnGroup>
                  <DataColumn name="quotaCover">
                    <Property name="property">quotaCover.name</Property>
                    <Property name="caption">口径</Property>
                    <Property name="width">90</Property>
                    <Property name="align">center</Property>
                  </DataColumn>
                  <DataColumn>
                    <Property name="name">quotaPropertiesNames</Property>
                    <Property name="property">quotaPropertiesNames</Property>
                    <Property name="dataType">String</Property>
                    <Property name="caption">指标属性</Property>
                    <Property name="width">130</Property>
                    <Property name="wrappable">true</Property>
                    <Editor/>
                  </DataColumn>
                </DataGrid>
                <UpdateAction id="uaQuotaItemCreator">
                  <Property name="dataResolver">quotaItemCreatorDao#saveQuotaItemCreatorsWithFormula</Property>
                  <Property name="successMessage">保存成功!</Property>
                  <Property name="executingMessage">正在保存..</Property>
                  <UpdateItem>
                    <Property name="dataSet">dsQuotaItemCreator2</Property>
                  </UpdateItem>
                </UpdateAction>
                <Dialog id="dlgQuotaItemCreator">
                  <Property name="closeable">false</Property>
                  <Property name="width">1150</Property>
                  <Property name="height">500</Property>
                  <Property name="caption">选择要关联该公式的指标</Property>
                  <Buttons/>
                  <Children>
                    <ToolBar>
                      <ToolBarButton>
                        <ClientEvent name="onClick">var dgQuotaItemCreator=view.get(&quot;#dgQuotaItemCreator&quot;);&#xD;
var dgQuotaItemCreatorSelected=view.get(&quot;#dgQuotaItemCreatorSelected&quot;);&#xD;
var datas = view.get(&quot;#dsQuotaItemCreator2&quot;).get(&quot;data&quot;);&#xD;
var selection=dgQuotaItemCreator.get(&quot;selection&quot;);&#xD;
var messge;&#xD;
&#xD;
if (selection &amp;&amp; selection.length){&#xD;
	selection.each(function(data){&#xD;
		var isAdded=false;&#xD;
		datas.each(function(dataAdded){&#xD;
			if(dataAdded.get(&quot;id&quot;)==data.get(&quot;id&quot;)){&#xD;
				isAdded=true;&#xD;
			}&#xD;
		});&#xD;
		if(isAdded==false){&#xD;
			datas.insert(data.toJSON());&#xD;
		}&#xD;
		dgQuotaItemCreatorSelected.refresh();&#xD;
	});&#xD;
	view.get(&quot;#dlgQuotaItemCreator&quot;).hide();&#xD;
}&#xD;
else {&#xD;
	message = &quot;未选中任何指标种类！&quot;;&#xD;
	dorado.MessageBox.alert(message);&#xD;
}</ClientEvent>
                        <Property name="caption">确定</Property>
                        <Property name="icon">url(>skin>common/icons.gif) -20px 0px</Property>
                      </ToolBarButton>
                      <ToolBarButton>
                        <ClientEvent name="onClick">var data=view.get(&quot;#dsQuotaItemCreator2&quot;).getData();&#xD;
var dialog=view.get(&quot;#dlgQuotaItemCreator&quot;);&#xD;
dorado.MessageBox.confirm(&quot;您真的要取消当前操作吗？&quot;,function(){&#xD;
	data.cancel();&#xD;
	dialog.hide();&#xD;
});</ClientEvent>
                        <Property name="caption">取消</Property>
                        <Property name="icon">url(>skin>common/icons.gif) -40px 0px</Property>
                      </ToolBarButton>
                    </ToolBar>
                    <SplitPanel>
                      <Property name="position">180</Property>
                      <MainControl>
                        <Container>
                          <DataGrid id="dgQuotaItemCreator">
                            <Property name="dataSet">dsQuotaItemCreator</Property>
                            <Property name="dataType">QuotaItemCreator</Property>
                            <Property name="dynaRowHeight">true</Property>
                            <Property name="readOnly">true</Property>
                            <Property name="stretchColumnsMode">allColumns</Property>
                            <Property name="selectionMode">multiRows</Property>
                            <IndicatorColumn/>
                            <RowSelectorColumn/>
                            <DataColumn name="id">
                              <Property name="property">id</Property>
                              <Property name="visible">false</Property>
                            </DataColumn>
                            <DataColumn name="name">
                              <Property name="visible">false</Property>
                            </DataColumn>
                            <DataColumn>
                              <Property name="property">quotaType.name</Property>
                              <Property name="name">showName</Property>
                              <Property name="caption">指标名称</Property>
                              <Property name="width">160</Property>
                              <Property name="wrappable">true</Property>
                              <Editor>
                                <TextArea/>
                              </Editor>
                            </DataColumn>
                            <DataColumn name="quotaDutyDept">
                              <Property name="property">quotaDutyDept.name</Property>
                              <Property name="visible">true</Property>
                              <Property name="caption">责任部门</Property>
                              <Property name="width">80</Property>
                              <Property name="align">center</Property>
                            </DataColumn>
                            <DataColumn name="year">
                              <Property name="property">year</Property>
                              <Property name="caption">年度</Property>
                              <Property name="width">60</Property>
                              <Property name="align">center</Property>
                            </DataColumn>
                            <ColumnGroup>
                              <Property name="caption">指标种类信息</Property>
                              <DataColumn name="quotaType">
                                <Property name="property">quotaType</Property>
                                <Property name="visible">false</Property>
                              </DataColumn>
                              <DataColumn>
                                <Property name="property">quotaType.name</Property>
                                <Property name="name">quotaTypeName</Property>
                                <Property name="caption">指标种类名称</Property>
                                <Property name="width">160</Property>
                                <Property name="visible">false</Property>
                                <Editor/>
                              </DataColumn>
                              <DataColumn>
                                <Property name="property">quotaType.rate</Property>
                                <Property name="name">quotaTypeRate</Property>
                                <Property name="caption">考核频率</Property>
                                <Property name="width">60</Property>
                                <Property name="align">center</Property>
                                <Editor/>
                              </DataColumn>
                              <DataColumn>
                                <Property name="property">quotaType.quotaLevel.name</Property>
                                <Property name="name">quotaLevel</Property>
                                <Property name="caption">指标级别</Property>
                                <Property name="width">80</Property>
                                <Property name="align">center</Property>
                                <Editor/>
                              </DataColumn>
                              <DataColumn>
                                <Property name="property">quotaType.quotaUnit.name</Property>
                                <Property name="name">quotaUnit</Property>
                                <Property name="caption">计量单位</Property>
                                <Property name="width">60</Property>
                                <Property name="align">center</Property>
                                <Editor/>
                              </DataColumn>
                              <DataColumn>
                                <Property name="property">quotaType.manageDept.name</Property>
                                <Property name="name">manageDept</Property>
                                <Property name="caption">管理部门</Property>
                                <Property name="width">80</Property>
                                <Editor/>
                              </DataColumn>
                              <DataColumn>
                                <Property name="property">quotaType.quotaDimension.name</Property>
                                <Property name="caption">维度</Property>
                                <Property name="width">80</Property>
                                <Property name="align">center</Property>
                                <Property name="name">quotaDimension</Property>
                              </DataColumn>
                            </ColumnGroup>
                            <DataColumn name="quotaCover">
                              <Property name="property">quotaCover.name</Property>
                              <Property name="caption">口径</Property>
                              <Property name="width">90</Property>
                              <Property name="align">center</Property>
                            </DataColumn>
                            <DataColumn>
                              <Property name="name">quotaPropertiesNames</Property>
                              <Property name="property">quotaPropertiesNames</Property>
                              <Property name="dataType">String</Property>
                              <Property name="caption">指标属性</Property>
                              <Property name="width">130</Property>
                              <Property name="wrappable">true</Property>
                              <Editor/>
                            </DataColumn>
                          </DataGrid>
                        </Container>
                      </MainControl>
                      <SideControl>
                        <DataTree id="dtrDepartment">
                          <ClientEvent name="onClick">var dtrDepartment=view.get(&quot;#dtrDepartment&quot;);&#xD;
var currentDepartment=dtrDepartment.get(&quot;currentEntity&quot;);&#xD;
var manageDeptId=currentDepartment.get(&quot;id&quot;);&#xD;
var dsQuotaItemCreator=view.get(&quot;#dsQuotaItemCreator&quot;);&#xD;
var dsQuotaType=view.get(&quot;#dsQuotaType&quot;);&#xD;
var dsQuotaPropertyValue=view.get(&quot;#dsQuotaPropertyValue&quot;);&#xD;
var dgQuotaPropertyValue=view.get(&quot;#dgQuotaPropertyValue&quot;);&#xD;
var dtrQuotaFormulaResult=view.get(&quot;#dtrQuotaFormulaResult&quot;);&#xD;
var currentQuotaFormulaResult=dtrQuotaFormulaResult.get(&quot;currentEntity&quot;);&#xD;
var quotaFormulaResultId=currentQuotaFormulaResult.get(&quot;id&quot;);&#xD;
var quotaItemCreatorId=null;&#xD;
&#xD;
dsQuotaItemCreator.set(&quot;parameter&quot;,{manageDeptId:manageDeptId,quotaFormulaResultId:quotaFormulaResultId}).flushAsync();&#xD;
dsQuotaType.set(&quot;parameter&quot;,{manageDeptId:manageDeptId}).flushAsync();&#xD;
dsQuotaPropertyValue.set(&quot;parameter&quot;,{quotaItemCreatorId:quotaItemCreatorId}).flushAsync();&#xD;
dgQuotaPropertyValue.refresh();&#xD;
</ClientEvent>
                          <Property name="allowNoCurrent">true</Property>
                          <Property name="dataSet">dsDepartment</Property>
                          <BindingConfigs>
                            <BindingConfig>
                              <Property name="icon">url(>skin>common/icons.gif) -0px -20px</Property>
                              <Property name="name">department</Property>
                              <Property name="labelProperty">name</Property>
                            </BindingConfig>
                          </BindingConfigs>
                        </DataTree>
                      </SideControl>
                    </SplitPanel>
                  </Children>
                  <Tools/>
                </Dialog>
              </Container>
            </MainControl>
            <SideControl>
              <DataGrid id="dgQuotaFormula">
                <ClientEvent name="onClick">var dsQuotaItemCreator2=view.get(&quot;#dsQuotaItemCreator2&quot;);&#xD;
var dgQuotaFormula=view.get(&quot;#dgQuotaFormula&quot;);&#xD;
var dgQuotaFormulaSelected=view.get(&quot;#dgQuotaFormulaSelected&quot;);&#xD;
var currentFormula=dgQuotaFormula.getCurrentItem();&#xD;
var quotaFormulaId=currentFormula.get(&quot;id&quot;);&#xD;
&#xD;
dsQuotaItemCreator2.set(&quot;parameter&quot;,{quotaFormulaId:quotaFormulaId}).flushAsync();&#xD;
dgQuotaFormulaSelected.refresh();</ClientEvent>
                <Property name="dataSet">dsQuotaFormula</Property>
                <Property name="dataType">QuotaFormula</Property>
                <Property name="selectionMode">multiRows</Property>
                <Property name="stretchColumnsMode">allColumns</Property>
                <Property name="dynaRowHeight">true</Property>
                <Property name="readOnly">true</Property>
                <DataColumn name="id">
                  <Property name="property">id</Property>
                  <Property name="visible">false</Property>
                  <Property name="readOnly">true</Property>
                </DataColumn>
                <DataColumn name="name">
                  <Property name="property">name</Property>
                  <Property name="width">260</Property>
                  <Property name="caption">公式名称</Property>
                  <Property name="wrappable">true</Property>
                  <Editor>
                    <TextArea>
                      <Property name="height">100</Property>
                    </TextArea>
                  </Editor>
                </DataColumn>
                <DataColumn name="formula">
                  <Property name="property">formula</Property>
                  <Property name="caption">公式</Property>
                  <Property name="width">280</Property>
                  <Property name="wrappable">true</Property>
                  <Editor>
                    <TextArea>
                      <Property name="height">100</Property>
                    </TextArea>
                  </Editor>
                </DataColumn>
                <DataColumn name="quotaFormulaResult">
                  <Property name="property">quotaFormulaResult</Property>
                  <Property name="visible">false</Property>
                  <Property name="readOnly">true</Property>
                </DataColumn>
                <DataColumn name="remark">
                  <Property name="property">remark</Property>
                  <Property name="caption">备注</Property>
                  <Property name="width">300</Property>
                  <Property name="wrappable">true</Property>
                  <Editor>
                    <TextArea>
                      <Property name="height">100</Property>
                    </TextArea>
                  </Editor>
                </DataColumn>
              </DataGrid>
            </SideControl>
          </SplitPanel>
        </Container>
      </MainControl>
      <SideControl>
        <DataTree id="dtrQuotaFormulaResult">
          <ClientEvent name="onClick">var dtrQuotaFormulaResult=view.get(&quot;#dtrQuotaFormulaResult&quot;);&#xD;
var currentQuotaFormulaResult=dtrQuotaFormulaResult.get(&quot;currentEntity&quot;);&#xD;
var quotaFormulaResultId=currentQuotaFormulaResult.get(&quot;id&quot;);&#xD;
var dsQuotaFormula=view.get(&quot;#dsQuotaFormula&quot;);&#xD;
&#xD;
dsQuotaFormula.set(&quot;parameter&quot;,{quotaFormulaResultId:quotaFormulaResultId}).flushAsync();</ClientEvent>
          <Property name="dataSet">dsQuotaFormulaResult</Property>
          <Property name="allowNoCurrent">true</Property>
          <BindingConfigs>
            <BindingConfig>
              <Property name="name">quotaFormulaResult</Property>
              <Property name="labelProperty">name</Property>
              <Property name="icon">url(>skin>common/icons.gif) -0px -200px</Property>
            </BindingConfig>
          </BindingConfigs>
        </DataTree>
      </SideControl>
    </SplitPanel>
  </View>
</ViewConfig>
